// Ion.Zoom
// version 1.0.29
// http://ionden.com/a/plugins/ion.zoom/
(function(d){d.fn.ionZoom=function(l){var j=this,e=null,f=null;d.extend({},l);({init:function(){var a=this;this.isAnimate=this.isOpend=!1;this.current=null;this.link="";this.newCurrent=null;this.newLink="";this.num=j.length;this.currentSize={};this.body=d(document.body);j.on("click",function(b){b.preventDefault();a.isOpend?(a.newCurrent=d(this),a.newLink=d(this).prop("href"),a.closeCurrent(!0)):(a.current=d(this),a.link=d(this).prop("href"),a.getSize())});d(document.body).on("keydown",function(b){27==
b.which&&a.isOpend&&a.closeCurrent();if(37==b.which&&a.isOpend&&!a.isAnimate){var c=a.current.prev();c.length||(c=j.eq(a.num-1));a.newCurrent=c;a.newLink=c.prop("href");a.closeCurrent(!0)}39==b.which&&(a.isOpend&&!a.isAnimate)&&(b=a.current.next(),b.length||(b=j.eq(0)),a.newCurrent=b,a.newLink=b.prop("href"),a.closeCurrent(!0))});this.prepare()},prepare:function(){var a=this;this.body.append('<div class="ion-zoom-preloader" id="ion-zoom-preloader"></div><div class="ion-zoom-image" id="ion-zoom-image"></div>');
this.preloader=d("#ion-zoom-preloader");e=d("#ion-zoom-image");e.on("click",function(){a.closeCurrent()})},getSize:function(){var a=parseInt(this.current.css("border-left-width")),b=parseInt(this.current.css("padding-left")),c=parseInt(this.current.children("img").css("border-left-width")),d=parseInt(this.current.children("img").css("padding-left")),a=a+b,c=c+d;this.baseSize={x:this.current.offset().left+a+c,y:this.current.offset().top+a+c,w:this.current.width()-2*c,h:this.current.height()-2*c};this.showPreloader();
this.loadImage()},showPreloader:function(){var a=this.baseSize.x+this.baseSize.w/2;this.preloader.css("top",this.baseSize.y+this.baseSize.h/2).css("left",a)},loadImage:function(){var a=this;e.append('<img src="'+this.link+'" />');f=e.children("img");f.on("load",function(){a.currentSize.w=f.width();a.currentSize.h=f.height();a.placeImage()})},placeImage:function(){this.preloader.css("top","-9999px").css("left","-9999px");f.width(this.baseSize.w).height(this.baseSize.h);e.width(this.baseSize.w).height(this.baseSize.h);
e.css("left",this.baseSize.x).css("top",this.baseSize.y);this.prepareZoom()},prepareZoom:function(){var a=d(window).innerWidth()-40,b=d(window).innerHeight()-40,c=d(window).scrollTop(),e=this.currentSize.h/this.currentSize.w,h=this.baseSize.x+this.baseSize.w/2-this.currentSize.w/2,f=this.baseSize.y+this.baseSize.h/2-this.currentSize.h/2,g=this.currentSize.w,k=this.currentSize.h;g>a&&(g=a,k=a*e,h=this.baseSize.x+this.baseSize.w/2-g/2);k>b&&(k=b,g=b/e,h=this.baseSize.x+this.baseSize.w/2-g/2);h+g>a&&
(h=a-g-20);f+k>20+c+b&&(f=c+b-k);20>h&&(h=20);f<c+20&&(f=c+20);this.zoom(h,f,g,k,!1,!1)},closeCurrent:function(a){a?this.zoom(this.baseSize.x,this.baseSize.y,this.baseSize.w,this.baseSize.h,!0,!0):this.zoom(this.baseSize.x,this.baseSize.y,this.baseSize.w,this.baseSize.h,!0,!1)},zoom:function(a,b,c,d,h,j){var g=this;this.isAnimate=!0;e.stop().animate({left:a,top:b,width:c,height:d},{step:function(a,b){"width"==b.prop&&f.width(a+"px");"height"==b.prop&&f.height(a+"px")},duration:300,complete:function(){h?
(g.hideOld(),j&&g.setNew()):g.isOpend=!0;g.isAnimate=!1}})},setNew:function(){this.current=this.newCurrent;this.link=this.newLink;this.getSize()},hideOld:function(){e.css("top","-9999px").css("left","-9999px");e.width("0px").height("0px");e.html("");this.isOpend=!1}}).init()}})(jQuery);